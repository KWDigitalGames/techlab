  - name: Set up docker repository
    shell: |
      yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
    args:
      warn: no
  - name: Install the latest version of Docker Engine and containerd
    dnf:
      name:
        - docker-ce
        - docker-ce-cli
        - containerd.io
  - name: Start Docker service
    ansible.builtin.systemd:
      state: started
      name: docker
      enabled: yes
  - name: Create build directory
    ansible.builtin.file:
      path: /tmp/docker/appserver
      state: directory
      mode: 0755
  - name: Copy dockerfile to builds directory
    template: src=./files/appserver.dockerfile dest=/tmp/docker/appserver/Dockerfile
  - name: Build an image
    ansible.builtin.shell: docker build -t tomcat /tmp/docker/appserver
  - name: Run container
    ansible.builtin.shell: docker run -dit --rm -p 8080:8080 tomcat
    
